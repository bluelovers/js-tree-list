"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const node_1 = require("./node");
const utils_1 = require("./utils");
// @ts-ignore
const util_1 = require("util");
class Tree {
    constructor(object = undefined, mode, options = {}) {
        this.options = {
            libTreeNode: node_1.default,
        };
        Object.assign(this.options, options);
        this.rootNode = null;
        if (object) {
            this.rootNode = this.createNode(object, mode);
        }
    }
    createNode(object, mode) {
        let libTreeNode = this.options.libTreeNode;
        let node = new libTreeNode(object, mode);
        node[utils_1.SYMBOL_OPTIONS] = {
            tree: this,
            options: this.options,
        };
        return node;
    }
    root() {
        return this.rootNode;
    }
    // only for rootNode
    get(path) {
        return this.rootNode.get(path);
    }
    // only for rootNode
    set(path, value) {
        return this.rootNode.set(path, value);
    }
    add(callback, object, mode) {
        const type = typeof callback;
        if (type === 'string' && callback === 'root') {
            this.rootNode = this.createNode(object, mode);
            return this.rootNode;
        }
        else if (type === 'function') {
            const target = utils_1.searchNode(this, null, callback);
            if (target) {
                let node = target.add(object, mode);
                if (node) {
                    return node;
                }
            }
            console.log('Warning', object);
            throw new Error('Warning ' + util_1.inspect(object));
        }
    }
    contains(criteria) {
        return utils_1.searchNode(this, null, criteria);
    }
    remove(criteria) {
        const targetNode = this.contains(criteria);
        if (targetNode) {
            return !!targetNode.parent.remove(criteria);
        }
        return false;
    }
    move(search, destination) {
        const targetNode = this.contains(search);
        if (targetNode && this.remove(search)) {
            const destinationNode = this.contains(destination);
            return !!destinationNode.add(targetNode);
        }
        return false;
    }
    traversal(criteria, callback) {
        utils_1.traversalTree(this, null, criteria, callback);
    }
    sort(compare) {
        this.traversal(null, currentNode => {
            currentNode.sort(compare);
        });
        return this;
    }
    toJSON(...argv) {
        return this.root().toJSON();
    }
    toJson(options = {}) {
        const optionsDefault = {
            key_children: 'children',
            empty_children: true
        };
        let opts = Object.assign(optionsDefault, options);
        const result = utils_1.serializeTree(this, null, [], opts);
        if (!options.empty_children) {
            utils_1.removeEmptyChildren(result, null, opts);
        }
        if (result && result.length > 0) {
            return result[0];
        }
        else {
            return [];
        }
    }
}
exports.Tree = Tree;
exports.default = Tree;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInRyZWUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxpQ0FBNEM7QUFDNUMsbUNBS2dCO0FBRWhCLGFBQWE7QUFDYiwrQkFBK0I7QUFZL0IsTUFBYSxJQUFJO0lBUWhCLFlBQVksU0FBWSxTQUFTLEVBQUUsSUFBYyxFQUFFLFVBQXdCLEVBQUU7UUFKN0UsWUFBTyxHQUFpQjtZQUN2QixXQUFXLEVBQUUsY0FBUTtTQUNyQixDQUFDO1FBSUQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBRXJDLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFBO1FBQ3BCLElBQUksTUFBTSxFQUNWO1lBQ0MsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQztTQUM5QztJQUNGLENBQUM7SUFFRCxVQUFVLENBQUksTUFBUyxFQUFFLElBQWM7UUFFdEMsSUFBSSxXQUFXLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUM7UUFFM0MsSUFBSSxJQUFJLEdBQUcsSUFBSSxXQUFXLENBQUksTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBRTVDLElBQUksQ0FBQyxzQkFBYyxDQUFDLEdBQUc7WUFDdEIsSUFBSSxFQUFFLElBQUk7WUFDVixPQUFPLEVBQUUsSUFBSSxDQUFDLE9BQU87U0FDckIsQ0FBQztRQUVGLE9BQU8sSUFBSSxDQUFDO0lBQ2IsQ0FBQztJQUVELElBQUk7UUFFSCxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUM7SUFDdEIsQ0FBQztJQUVELG9CQUFvQjtJQUNwQixHQUFHLENBQXFCLElBQWU7UUFFdEMsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBSyxJQUFJLENBQUMsQ0FBQTtJQUNuQyxDQUFDO0lBRUQsb0JBQW9CO0lBQ3BCLEdBQUcsQ0FB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TUFBTSxNQUFNLEdBQUcscUJBQWEsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMsQ0FBQTtRQUVsRCxJQUFJLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFDM0I7WUFDQywyQkFBbUIsQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFBO1NBQ3ZDO1FBRUQsSUFBSSxNQUFNLElBQUksTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQy9CO1lBQ0MsT0FBTyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUE7U0FDaEI7YUFFRDtZQUNDLE9BQU8sRUFBUyxDQUFBO1NBQ2hCO0lBQ0YsQ0FBQztDQUNEO0FBbkpELG9CQW1KQztBQUVELGtCQUFlLElBQUksQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBUcmVlTm9kZSwgeyBJRmllbGRLZXkgfSBmcm9tICcuL25vZGUnXG5pbXBvcnQge1xuXHRzZWFyY2hOb2RlLFxuXHR0cmF2ZXJzYWxUcmVlLFxuXHRzZXJpYWxpemVUcmVlLFxuXHRyZW1vdmVFbXB0eUNoaWxkcmVuLCBTWU1CT0xfT1BUSU9OU1xufSBmcm9tICcuL3V0aWxzJ1xuXG4vLyBAdHMtaWdub3JlXG5pbXBvcnQgeyBpbnNwZWN0IH0gZnJvbSAndXRpbCc7XG5cbmV4cG9ydCB0eXBlIElUcmVlT3B0aW9ucyA9IHtcblx0bGliVHJlZU5vZGU/OiB0eXBlb2YgVHJlZU5vZGUsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSVRyZWVUb0pzb25PcHRpb25zXG57XG5cdGtleV9jaGlsZHJlbjogc3RyaW5nLFxuXHRlbXB0eV9jaGlsZHJlbj86IGJvb2xlYW4sXG59XG5cbmV4cG9ydCBjbGFzcyBUcmVlPFQgZXh0ZW5kcyBhbnkgPSBhbnk+XG57XG5cdHJvb3ROb2RlOiBUcmVlTm9kZTxUPjtcblxuXHRvcHRpb25zOiBJVHJlZU9wdGlvbnMgPSB7XG5cdFx0bGliVHJlZU5vZGU6IFRyZWVOb2RlLFxuXHR9O1xuXG5cdGNvbnN0cnVjdG9yKG9iamVjdDogVCA9IHVuZGVmaW5lZCwgbW9kZT86IGJvb2xlYW4sIG9wdGlvbnM6IElUcmVlT3B0aW9ucyA9IHt9KVxuXHR7XG5cdFx0T2JqZWN0LmFzc2lnbih0aGlzLm9wdGlvbnMsIG9wdGlvbnMpO1xuXG5cdFx0dGhpcy5yb290Tm9kZSA9IG51bGxcblx0XHRpZiAob2JqZWN0KVxuXHRcdHtcblx0XHRcdHRoaXMucm9vdE5vZGUgPSB0aGlzLmNyZWF0ZU5vZGUob2JqZWN0LCBtb2RlKTtcblx0XHR9XG5cdH1cblxuXHRjcmVhdGVOb2RlPFQ+KG9iamVjdDogVCwgbW9kZT86IGJvb2xlYW4pXG5cdHtcblx0XHRsZXQgbGliVHJlZU5vZGUgPSB0aGlzLm9wdGlvbnMubGliVHJlZU5vZGU7XG5cblx0XHRsZXQgbm9kZSA9IG5ldyBsaWJUcmVlTm9kZTxUPihvYmplY3QsIG1vZGUpO1xuXG5cdFx0bm9kZVtTWU1CT0xfT1BUSU9OU10gPSB7XG5cdFx0XHR0cmVlOiB0aGlzLFxuXHRcdFx0b3B0aW9uczogdGhpcy5vcHRpb25zLFxuXHRcdH07XG5cblx0XHRyZXR1cm4gbm9kZTtcblx0fVxuXG5cdHJvb3QoKVxuXHR7XG5cdFx0cmV0dXJuIHRoaXMucm9vdE5vZGU7XG5cdH1cblxuXHQvLyBvbmx5IGZvciByb290Tm9kZVxuXHRnZXQ8VFQgZXh0ZW5kcyB1bmtub3duPihwYXRoOiBJRmllbGRLZXkpXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5yb290Tm9kZS5nZXQ8VFQ+KHBhdGgpXG5cdH1cblxuXHQvLyBvbmx5IGZvciByb290Tm9kZVxuXHRzZXQocGF0aDogSUZpZWxkS2V5LCB2YWx1ZSlcblx0e1xuXHRcdHJldHVybiB0aGlzLnJvb3ROb2RlLnNldChwYXRoLCB2YWx1ZSlcblx0fVxuXG5cdGFkZChjYWxsYmFjazogKHBhcmVudE5vZGUpID0+IGJvb2xlYW4sIG9iamVjdCwgbW9kZT86IGJvb2xlYW4pXG5cdGFkZChjYWxsYmFjazogJ3Jvb3QnLCBvYmplY3QsIG1vZGU/OiBib29sZWFuKVxuXHRhZGQoY2FsbGJhY2ssIG9iamVjdCwgbW9kZT86IGJvb2xlYW4pXG5cdHtcblx0XHRjb25zdCB0eXBlID0gdHlwZW9mIGNhbGxiYWNrXG5cdFx0aWYgKHR5cGUgPT09ICdzdHJpbmcnICYmIGNhbGxiYWNrID09PSAncm9vdCcpXG5cdFx0e1xuXHRcdFx0dGhpcy5yb290Tm9kZSA9IHRoaXMuY3JlYXRlTm9kZShvYmplY3QsIG1vZGUpXG5cdFx0XHRyZXR1cm4gdGhpcy5yb290Tm9kZVxuXHRcdH1cblx0XHRlbHNlIGlmICh0eXBlID09PSAnZnVuY3Rpb24nKVxuXHRcdHtcblx0XHRcdGNvbnN0IHRhcmdldCA9IHNlYXJjaE5vZGUodGhpcywgbnVsbCwgY2FsbGJhY2spXG5cblx0XHRcdGlmICh0YXJnZXQpXG5cdFx0XHR7XG5cdFx0XHRcdGxldCBub2RlID0gdGFyZ2V0LmFkZChvYmplY3QsIG1vZGUpO1xuXHRcdFx0XHRpZiAobm9kZSlcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHJldHVybiBub2RlO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGNvbnNvbGUubG9nKCdXYXJuaW5nJywgb2JqZWN0KVxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCdXYXJuaW5nICcgKyBpbnNwZWN0KG9iamVjdCkpO1xuXHRcdH1cblx0fVxuXG5cdGNvbnRhaW5zKGNyaXRlcmlhKVxuXHR7XG5cdFx0cmV0dXJuIHNlYXJjaE5vZGUodGhpcywgbnVsbCwgY3JpdGVyaWEpXG5cdH1cblxuXHRyZW1vdmUoY3JpdGVyaWEpXG5cdHtcblx0XHRjb25zdCB0YXJnZXROb2RlID0gdGhpcy5jb250YWlucyhjcml0ZXJpYSlcblx0XHRpZiAodGFyZ2V0Tm9kZSlcblx0XHR7XG5cdFx0XHRyZXR1cm4gISF0YXJnZXROb2RlLnBhcmVudC5yZW1vdmUoY3JpdGVyaWEpXG5cdFx0fVxuXHRcdHJldHVybiBmYWxzZVxuXHR9XG5cblx0bW92ZShzZWFyY2gsIGRlc3RpbmF0aW9uKVxuXHR7XG5cdFx0Y29uc3QgdGFyZ2V0Tm9kZSA9IHRoaXMuY29udGFpbnMoc2VhcmNoKVxuXHRcdGlmICh0YXJnZXROb2RlICYmIHRoaXMucmVtb3ZlKHNlYXJjaCkpXG5cdFx0e1xuXHRcdFx0Y29uc3QgZGVzdGluYXRpb25Ob2RlID0gdGhpcy5jb250YWlucyhkZXN0aW5hdGlvbilcblx0XHRcdHJldHVybiAhIWRlc3RpbmF0aW9uTm9kZS5hZGQodGFyZ2V0Tm9kZSlcblx0XHR9XG5cdFx0cmV0dXJuIGZhbHNlXG5cdH1cblxuXHR0cmF2ZXJzYWwoY3JpdGVyaWEsIGNhbGxiYWNrOiAoY3VycmVudE5vZGUpID0+IHZvaWQpXG5cdHtcblx0XHR0cmF2ZXJzYWxUcmVlKHRoaXMsIG51bGwsIGNyaXRlcmlhLCBjYWxsYmFjaylcblx0fVxuXG5cdHNvcnQoY29tcGFyZTogKGE6IFQsIGI6IFQpID0+IG51bWJlcilcblx0e1xuXHRcdHRoaXMudHJhdmVyc2FsKG51bGwsIGN1cnJlbnROb2RlID0+XG5cdFx0e1xuXHRcdFx0Y3VycmVudE5vZGUuc29ydChjb21wYXJlKVxuXHRcdH0pXG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdHRvSlNPTiguLi5hcmd2KVxuXHR7XG5cdFx0cmV0dXJuIHRoaXMucm9vdCgpLnRvSlNPTigpO1xuXHR9XG5cblx0dG9Kc29uKG9wdGlvbnM6IFBhcnRpYWw8SVRyZWVUb0pzb25PcHRpb25zPiA9IHt9KVxuXHR7XG5cdFx0Y29uc3Qgb3B0aW9uc0RlZmF1bHQ6IElUcmVlVG9Kc29uT3B0aW9ucyA9IHtcblx0XHRcdGtleV9jaGlsZHJlbjogJ2NoaWxkcmVuJyxcblx0XHRcdGVtcHR5X2NoaWxkcmVuOiB0cnVlXG5cdFx0fVxuXHRcdGxldCBvcHRzID0gT2JqZWN0LmFzc2lnbihvcHRpb25zRGVmYXVsdCwgb3B0aW9ucylcblx0XHRjb25zdCByZXN1bHQgPSBzZXJpYWxpemVUcmVlKHRoaXMsIG51bGwsIFtdLCBvcHRzKVxuXG5cdFx0aWYgKCFvcHRpb25zLmVtcHR5X2NoaWxkcmVuKVxuXHRcdHtcblx0XHRcdHJlbW92ZUVtcHR5Q2hpbGRyZW4ocmVzdWx0LCBudWxsLCBvcHRzKVxuXHRcdH1cblxuXHRcdGlmIChyZXN1bHQgJiYgcmVzdWx0Lmxlbmd0aCA+IDApXG5cdFx0e1xuXHRcdFx0cmV0dXJuIHJlc3VsdFswXVxuXHRcdH1cblx0XHRlbHNlXG5cdFx0e1xuXHRcdFx0cmV0dXJuIFtdIGFzIFRbXVxuXHRcdH1cblx0fVxufVxuXG5leHBvcnQgZGVmYXVsdCBUcmVlXG4iXX0=