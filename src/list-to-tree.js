"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tree_1 = require("./tree");
// @ts-ignore
const util_1 = require("util");
const defaultOptions = {
    key_id: 'id',
    key_parent: 'parent',
    key_child: 'child',
    key_last: null,
    uuid: false,
    empty_children: false
};
function sortBy(collection, propertyA, propertyB) {
    return collection.sort(function (a, b) {
        if (a[propertyB] < b[propertyB]) {
            if (a[propertyA] > b[propertyA]) {
                return 1;
            }
            return -1;
        }
        else {
            if (a[propertyA] < b[propertyA]) {
                return -1;
            }
            return 1;
        }
    });
}
class ListToTree {
    constructor(list, options = {}) {
        const _list = list.map(item => item);
        options = Object.assign({}, defaultOptions, options);
        this.options = options;
        const { key_id, key_parent, uuid } = options;
        if (uuid === false) {
            //sortBy(_list, key_parent, key_id)
        }
        const tree = new tree_1.default();
        _list.forEach((item, index) => {
            if (tree.rootNode === null) {
                if (item[key_parent]) {
                    throw new RangeError(`the first elem is root, should not have parent. ` + +util_1.inspect(item));
                }
                tree.add('root', item, true);
            }
            else {
                let node = tree.add(parentNode => {
                    //return parentNode.get(key_id) === item[key_parent]
                    return parentNode[key_id] === item[key_parent];
                }, item, true);
            }
        });
        this.tree = tree;
    }
    sort(criteria) {
        this.tree.sort(criteria);
    }
    last(val, key_id, key_last, key_child) {
        for (let n in val) {
            if (val[n][key_child] && val[n][key_child].length) { // 如果有子元素，则先对子元素进行处理
                this.last(val[n][key_child], key_id, key_last, key_child);
            }
            if (val[n][key_last] !== 0) {
                // @ts-ignore
                if (((n - 1) >= 0 && val[n - 1][key_id] !== val[n][key_last]) || (n - 1) < 0) {
                    const tmp = val.splice(n, 1); // 从该元素位置删除元素并将已删除的元素放置于新数组(tmp)
                    val.splice(n + 1, 0, tmp[0]); // 在指定ID元素后面添加被删除的元素
                }
            }
        }
    }
    GetTree() {
        const { key_id, key_child, empty_children, key_last } = this.options;
        let json = this.tree.toJson({
            key_children: key_child,
            empty_children: false
        })[key_child];
        if (key_last) {
            this.last(json, key_id, key_last, key_child);
        }
        return json;
    }
}
exports.ListToTree = ListToTree;
exports.default = ListToTree;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdC10by10cmVlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibGlzdC10by10cmVlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsaUNBQXdCO0FBQ3hCLGFBQWE7QUFDYiwrQkFBK0I7QUFFL0IsTUFBTSxjQUFjLEdBQXVCO0lBQzFDLE1BQU0sRUFBRSxJQUFJO0lBQ1osVUFBVSxFQUFFLFFBQVE7SUFDcEIsU0FBUyxFQUFFLE9BQU87SUFDbEIsUUFBUSxFQUFFLElBQUk7SUFDZCxJQUFJLEVBQUUsS0FBSztJQUNYLGNBQWMsRUFBRSxLQUFLO0NBQ3JCLENBQUE7QUFFRCxTQUFTLE1BQU0sQ0FBSSxVQUFlLEVBQUUsU0FBaUIsRUFBRSxTQUFpQjtJQUV2RSxPQUFPLFVBQVUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQztRQUVwQyxJQUFJLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsU0FBUyxDQUFDLEVBQy9CO1lBQ0MsSUFBSSxDQUFDLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxFQUMvQjtnQkFDQyxPQUFPLENBQUMsQ0FBQTthQUNSO1lBQ0QsT0FBTyxDQUFDLENBQUMsQ0FBQTtTQUNUO2FBRUQ7WUFDQyxJQUFJLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsU0FBUyxDQUFDLEVBQy9CO2dCQUNDLE9BQU8sQ0FBQyxDQUFDLENBQUE7YUFDVDtZQUNELE9BQU8sQ0FBQyxDQUFBO1NBQ1I7SUFDRixDQUFDLENBQUMsQ0FBQTtBQUNILENBQUM7QUF1QkQsTUFBYSxVQUFVO0lBT3RCLFlBQVksSUFBUyxFQUFFLFVBQWtDLEVBQUU7UUFFMUQsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFBO1FBRXBDLE9BQU8sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxj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QyxTQUFTLENBQUMsQ0FBQTtRQUViLElBQUksUUFBUSxFQUNaO1lBQ0MsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxTQUFTLENBQUMsQ0FBQTtTQUM1QztRQUNELE9BQU8sSUFBSSxDQUFBO0lBQ1osQ0FBQztDQUNEO0FBdEZELGdDQXNGQztBQUVELGtCQUFlLFVBQVUsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBMVFQgZnJvbSAnLi90cmVlJ1xuLy8gQHRzLWlnbm9yZVxuaW1wb3J0IHsgaW5zcGVjdCB9IGZyb20gJ3V0aWwnO1xuXG5jb25zdCBkZWZhdWx0T3B0aW9uczogSUxpc3RUb1RyZWVPcHRpb25zID0ge1xuXHRrZXlfaWQ6ICdpZCcsXG5cdGtleV9wYXJlbnQ6ICdwYXJlbnQnLFxuXHRrZXlfY2hpbGQ6ICdjaGlsZCcsXG5cdGtleV9sYXN0OiBudWxsLFxuXHR1dWlkOiBmYWxzZSxcblx0ZW1wdHlfY2hpbGRyZW46IGZhbHNlXG59XG5cbmZ1bmN0aW9uIHNvcnRCeTxUPihjb2xsZWN0aW9uOiBUW10sIHByb3BlcnR5QTogc3RyaW5nLCBwcm9wZXJ0eUI6IHN0cmluZylcbntcblx0cmV0dXJuIGNvbGxlY3Rpb24uc29ydChmdW5jdGlvbiAoYSwgYilcblx0e1xuXHRcdGlmIChhW3Byb3BlcnR5Ql0gPCBiW3Byb3BlcnR5Ql0pXG5cdFx0e1xuXHRcdFx0aWYgKGFbcHJvcGVydHlBXSA+IGJbcHJvcGVydHlBXSlcblx0XHRcdHtcblx0XHRcdFx0cmV0dXJuIDFcblx0XHRcdH1cblx0XHRcdHJldHVybiAtMVxuXHRcdH1cblx0XHRlbHNlXG5cdFx0e1xuXHRcdFx0aWYgKGFbcHJvcGVydHlBXSA8IGJbcHJvcGVydHlBXSlcblx0XHRcdHtcblx0XHRcdFx0cmV0dXJuIC0xXG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gMVxuXHRcdH1cblx0fSlcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJTGlzdFRvVHJlZVNvdXJjZU9iamVjdFxue1xuXHRba2V5OiBzdHJpbmddOiB1bmtub3duLFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIElMaXN0VG9UcmVlT3B0aW9uczxUIGV4dGVuZHMgSUxpc3RUb1RyZWVTb3VyY2VPYmplY3QgPSBJTGlzdFRvVHJlZVNvdXJjZU9iamVjdD5cbntcblx0a2V5X2lkPzogc3RyaW5nO1xuXHRrZXlfcGFyZW50Pzogc3RyaW5nO1xuXHRrZXlfY2hpbGQ/OiBzdHJpbmc7XG5cdGtleV9sYXN0Pzogc3RyaW5nO1xuXHR1dWlkPzogYm9vbGVhbjtcblx0ZW1wdHlfY2hpbGRyZW4/OiBib29sZWFuO1xufVxuXG5leHBvcnQgdHlwZSBJTGlzdFRvVHJlZU9wdGlvbnMyPFQgZXh0ZW5kcyBJTGlzdFRvVHJlZVNvdXJjZU9iamVjdD4gPSBJTGlzdFRvVHJlZU9wdGlvbnM8VD4gJiB7XG5cdGtleV9pZD86IHN0cmluZyB8IGtleW9mIFQ7XG5cdGtleV9wYXJlbnQ/OiBzdHJpbmcgfCBrZXlvZiBUO1xuXHRrZXlfY2hpbGQ/OiBzdHJpbmcgfCBrZXlvZiBUO1xufVxuXG5leHBvcnQgY2xhc3MgTGlzdFRvVHJlZTxUIGV4dGVuZHMgSUxpc3RUb1RyZWVTb3VyY2VPYmplY3Q+XG57XG5cblx0b3B0aW9uczogSUxpc3RUb1RyZWVPcHRpb25zPFQ+O1xuXG5cdHRyZWU6IExUVDtcblxuXHRjb25zdHJ1Y3RvcihsaXN0OiBUW10sIG9wdGlvbnM6IElMaXN0VG9UcmVlT3B0aW9uczI8VD4gPSB7fSlcblx0e1xuXHRcdGNvbnN0IF9saXN0ID0gbGlzdC5tYXAoaXRlbSA9PiBpdGVtKVxuXG5cdFx0b3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRPcHRpb25zLCBvcHRpb25zKVxuXHRcdHRoaXMub3B0aW9ucyA9IG9wdGlvbnNcblx0XHRjb25zdCB7IGtleV9pZCwga2V5X3BhcmVudCwgdXVpZCB9ID0gb3B0aW9uc1xuXG5cdFx0aWYgKHV1aWQgPT09IGZhbHNlKVxuXHRcdHtcblx0XHRcdC8vc29ydEJ5KF9saXN0LCBrZXlfcGFyZW50LCBrZXlfaWQpXG5cdFx0fVxuXG5cdFx0Y29uc3QgdHJlZSA9IG5ldyBMVFQoKVxuXG5cdFx0X2xpc3QuZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+XG5cdFx0e1xuXHRcdFx0aWYgKHRyZWUucm9vdE5vZGUgPT09IG51bGwpXG5cdFx0XHR7XG5cdFx0XHRcdGlmIChpdGVtW2tleV9wYXJlbnRdKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dGhyb3cgbmV3IFJhbmdlRXJyb3IoYHRoZSBmaXJzdCBlbGVtIGlzIHJvb3QsIHNob3VsZCBub3QgaGF2ZSBwYXJlbnQuIGAgKyAgKyBpbnNwZWN0KGl0ZW0pKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHRyZWUuYWRkKCdyb290JywgaXRlbSwgdHJ1ZSk7XG5cdFx0XHR9XG5cdFx0XHRlbHNlXG5cdFx0XHR7XG5cdFx0XHRcdGxldCBub2RlID0gdHJlZS5hZGQocGFyZW50Tm9kZSA9PlxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0Ly9yZXR1cm4gcGFyZW50Tm9kZS5nZXQoa2V5X2lkKSA9PT0gaXRlbVtrZXlfcGFyZW50XVxuXHRcdFx0XHRcdHJldHVybiBwYXJlbnROb2RlW2tleV9pZF0gPT09IGl0ZW1ba2V5X3BhcmVudF1cblx0XHRcdFx0fSwgaXRlbSwgdHJ1ZSk7XG5cdFx0XHR9XG5cdFx0fSlcblxuXHRcdHRoaXMudHJlZSA9IHRyZWVcblx0fVxuXG5cdHNvcnQoY3JpdGVyaWE6IChhOiBULCBiOiBUKSA9PiBudW1iZXIpXG5cdHtcblx0XHR0aGlzLnRyZWUuc29ydChjcml0ZXJpYSlcblx0fVxuXG5cdGxhc3QodmFsLCBrZXlfaWQsIGtleV9sYXN0LCBrZXlfY2hpbGQpXG5cdHtcblx0XHRmb3IgKGxldCBuIGluIHZhbClcblx0XHR7XG5cdFx0XHRpZiAodmFsW25dW2tleV9jaGlsZF0gJiYgdmFsW25dW2tleV9jaGlsZF0ubGVuZ3RoKVxuXHRcdFx0eyAvLyDlpoLmnpzmnInlrZDlhYPntKDvvIzliJnlhYjlr7nlrZDlhYPntKDov5vooYzlpITnkIZcblx0XHRcdFx0dGhpcy5sYXN0KHZhbFtuXVtrZXlfY2hpbGRdLCBrZXlfaWQsIGtleV9sYXN0LCBrZXlfY2hpbGQpXG5cdFx0XHR9XG5cdFx0XHRpZiAodmFsW25dW2tleV9sYXN0XSAhPT0gMClcblx0XHRcdHtcblx0XHRcdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdFx0XHRpZiAoKChuIC0gMSkgPj0gMCAmJiB2YWxbbiAtIDFdW2tleV9pZF0gIT09IHZhbFtuXVtrZXlfbGFzdF0pIHx8IChuIC0gMSkgPCAwKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0Y29uc3QgdG1wID0gdmFsLnNwbGljZShuLCAxKSAvLyDku47or6XlhYPntKDkvY3nva7liKDpmaTlhYPntKDlubblsIblt7LliKDpmaTnmoTlhYPntKDmlL7nva7kuo7mlrDmlbDnu4QodG1wKVxuXHRcdFx0XHRcdHZhbC5zcGxpY2UobiArIDEsIDAsIHRtcFswXSkgLy8g5Zyo5oyH5a6aSUTlhYPntKDlkI7pnaLmt7vliqDooqvliKDpmaTnmoTlhYPntKBcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdEdldFRyZWUoKVxuXHR7XG5cdFx0Y29uc3QgeyBrZXlfaWQsIGtleV9jaGlsZCwgZW1wdHlfY2hpbGRyZW4sIGtleV9sYXN0IH0gPSB0aGlzLm9wdGlvbnNcblxuXHRcdGxldCBqc29uID0gdGhpcy50cmVlLnRvSnNvbih7XG5cdFx0XHRrZXlfY2hpbGRyZW46IGtleV9jaGlsZCxcblx0XHRcdGVtcHR5X2NoaWxkcmVuOiBmYWxzZVxuXHRcdH0pW2tleV9jaGlsZF1cblxuXHRcdGlmIChrZXlfbGFzdClcblx0XHR7XG5cdFx0XHR0aGlzLmxhc3QoanNvbiwga2V5X2lkLCBrZXlfbGFzdCwga2V5X2NoaWxkKVxuXHRcdH1cblx0XHRyZXR1cm4ganNvblxuXHR9XG59XG5cbmV4cG9ydCBkZWZhdWx0IExpc3RUb1RyZWVcbiJdfQ==